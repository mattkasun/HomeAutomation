[{"id":"cfcf0bda.11d328","type":"tab","label":"Weather","disabled":false,"info":""},{"id":"ad7646e2.e0b638","type":"tab","label":"Lights","disabled":false,"info":""},{"id":"f846eb7.5c00618","type":"tab","label":"Lights2","disabled":false,"info":""},{"id":"a02f08d3.ba2c78","type":"tab","label":"Zwave","disabled":false,"info":""},{"id":"1d519822.8be128","type":"tab","label":"Flow 1","disabled":true,"info":""},{"id":"fc4d1b9b.590778","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"41b61283.3c66bc","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"true","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"44298b35.8d7074","type":"ui_group","z":"","name":"Wall Switch","tab":"5daaeb30.d403d4","order":1,"disp":true,"width":"6","collapse":true},{"id":"5daaeb30.d403d4","type":"ui_tab","z":"","name":"Lights","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"635dd72d.91c0e8","type":"darksky-credentials","z":"","key_identifier":"DarkSky"},{"id":"ac3d130c.55264","type":"ui_group","z":"","name":"DarkSky - Tommorrow","tab":"ddc81e89.4aa4b","order":3,"disp":true,"width":"6","collapse":false},{"id":"3561774d.19c258","type":"ui_group","z":"","name":"OpenWeather Map","tab":"ddc81e89.4aa4b","order":2,"disp":true,"width":"6","collapse":false},{"id":"ddc81e89.4aa4b","type":"ui_tab","z":"","name":"Weather","icon":"wi-wu-sunny","order":3,"disabled":false,"hidden":false},{"id":"f01b1ec9.c35bf","type":"ui_group","z":"","name":"Environment Canada","tab":"ddc81e89.4aa4b","order":1,"disp":true,"width":"6","collapse":false},{"id":"35c42763.98b268","type":"zwave-controller","z":"ad7646e2.e0b638","port":"/dev/ttyACM0","driverattempts":"3","pollinterval":"10000","allowunreadyupdates":false,"logging":"minimal"},{"id":"386605b8.09767a","type":"ui_group","z":"","name":"Lights","tab":"5daaeb30.d403d4","disp":true,"width":"6","collapse":true},{"id":"ad130b0a.c4e698","type":"ui_tab","z":"","name":"PatioLights","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"eea15960.b753f8","type":"ui_group","z":"","name":"Back Lights","tab":"ad130b0a.c4e698","order":1,"disp":true,"width":"6","collapse":false},{"id":"e532d965.990798","type":"zwave-controller","z":"","port":"/dev/ttyACM0","driverattempts":"3","pollinterval":"10000","allowunreadyupdates":false,"networkkey":"","logging":true},{"id":"27947665.ffe50a","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"hello","birthQos":"0","birthRetain":"true","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"7f607ec5.8792c","type":"ui_tab","z":"","name":"Misc","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"3c708b73.143c34","type":"ui_group","z":"","name":"Group 1","tab":"7f607ec5.8792c","order":1,"disp":false,"width":"6","collapse":false},{"id":"9c0b4f36.fcc99","type":"ui_group","z":"","name":"Video Capture","tab":"de3a19eb.761038","order":3,"disp":true,"width":"6"},{"id":"de3a19eb.761038","type":"ui_tab","z":"","name":"NVR","icon":"dashboard","order":13},{"id":"9a2a6ad4.863528","type":"config-log","z":"","logname":"zwave logs","logdir":"/tmp/zwave/","stamp":"local","logstyle":"plain","logrotate":true,"logcompress":true,"logrotatecount":"5","logsize":"1000"},{"id":"45698ede.3d32","type":"debug","z":"ad7646e2.e0b638","name":"","active":true,"tosidebar":true,"console":true,"complete":"true","x":193,"y":480,"wires":[]},{"id":"3058cb45.9fe614","type":"inject","z":"ad7646e2.e0b638","d":true,"name":"","topic":"","payload":"{\"topic\":\"addNode\",\"payload\":{\"prependHomeId\":true}}","payloadType":"json","repeat":"","crontab":"","once":true,"onceDelay":"","x":79,"y":112,"wires":[["cb681029.a7498","8cd5a770.123bf8"]]},{"id":"d2268652.5a1ac8","type":"ui_button","z":"ad7646e2.e0b638","name":"","group":"44298b35.8d7074","order":1,"width":0,"height":0,"passthru":false,"label":"ON","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"nodeid\":4}","payloadType":"json","topic":"switchOn","x":173,"y":767,"wires":[["8689aa2a.ad6878","594ed9e.88b3128"]]},{"id":"c8475454.aa8938","type":"ui_button","z":"ad7646e2.e0b638","name":"","group":"44298b35.8d7074","order":2,"width":0,"height":0,"passthru":false,"label":"OFF","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"nodeid\":4}","payloadType":"json","topic":"switchOff","x":176,"y":588,"wires":[["8689aa2a.ad6878"]]},{"id":"38073c45.95bf44","type":"ui_toast","z":"ad7646e2.e0b638","d":true,"position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":365,"y":417,"wires":[]},{"id":"79357313.7190dc","type":"ui_gauge","z":"ad7646e2.e0b638","name":"","group":"44298b35.8d7074","order":3,"width":0,"height":0,"gtype":"gage","title":"Status","label":"","format":"{{value}}","min":0,"max":"1","colors":["#ca3838","#e6e600","#00b500"],"seg1":"","seg2":"","x":290,"y":274,"wires":[]},{"id":"3e4ff5c6.4edd5a","type":"function","z":"ad7646e2.e0b638","name":"","func":"var msg2 = {\"payload\": 0};\nif (msg.payload.nodeid == 4) {\n    if (msg.payload.currState === true){\n        msg2.payload = 1;\n        msg.payload = true;\n    } else {\n        msg2.payload = 0;\n        msg.payload = false;\n    }\n}\n\nreturn [msg, msg2];","outputs":2,"noerr":0,"x":103,"y":270,"wires":[["f8c55397.7f155","f27b5101.fb806"],["8da8e0ef.f7773","79357313.7190dc"]],"inputLabels":["zwave"],"outputLabels":["bool","number"]},{"id":"6a352a07.8e7e64","type":"inject","z":"ad7646e2.e0b638","name":"","topic":"disablePoll","payload":"{\"args\":[4,37,1,0]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":157,"y":20,"wires":[["43c4db3a.541ff4"]]},{"id":"c2155055.b6869","type":"openweathermap","z":"cfcf0bda.11d328","name":"Ottawa weather","wtype":"current","lon":"-75.93025","lat":"45.17084","city":"","country":"","language":"en","x":320,"y":97,"wires":[["6491d281.b0f18c","d196c66a.79cd08","c831ca54.292b08"]]},{"id":"19f0900d.41b18","type":"darksky","z":"cfcf0bda.11d328","darksky":"635dd72d.91c0e8","name":"ottawa weather","lon":"-75.826900","lat":"45.327901","date":"","time":"","mode":"node","lang":"en","units":"ca","x":317,"y":295,"wires":[["b3edd2d0.98e0a","d196c66a.79cd08","29bdfa5e.0f5c96"]]},{"id":"c23b4833.fb8fe8","type":"inject","z":"cfcf0bda.11d328","name":"","topic":"","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":true,"onceDelay":0.1,"x":127,"y":215,"wires":[["19f0900d.41b18","c2155055.b6869"]]},{"id":"b3edd2d0.98e0a","type":"ui_template","z":"cfcf0bda.11d328","group":"ac3d130c.55264","name":"Weather-DarkSky-detail","order":2,"width":"6","height":"5","format":"<div>\n  <div style=\"font-size:48px;\">\n      <i class=\"wi wi-darksky-{{msg.payload.weather}}\"></i>\n  </div>\n  <ul>\n    <li>Time: {{msg.time}}</li>\n    <li>Weather: {{msg.payload.weather}} </li>\n    <li>Detail: {{msg.payload.detail}} </li>\n    <li>Humidity: {{msg.payload.humidity}} </li>\n    <li>Windspeed: {{msg.payload.windspeed}} </li>\n    <li>Winddirection: {{msg.payload.winddirection}} </li>\n    <li>Clouds: {{msg.payload.clouds }} </li>\n\n  </ul>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":976,"y":368,"wires":[[]]},{"id":"97f6d3cc.a8ed","type":"debug","z":"cfcf0bda.11d328","name":"Weather","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":946,"y":96,"wires":[]},{"id":"6491d281.b0f18c","type":"ui_template","z":"cfcf0bda.11d328","group":"3561774d.19c258","name":"Weather-OpeWeatherMap-details","order":1,"width":"0","height":"0","format":"<div>\n    <div style=\"flex; height=100%; font-size:48px; justify-content:center; align-items:center;\">\n        <i class=\"wi wi-owm-{{msg.payload.icon}}\"></i>    \n    </div>\n  <ul>\n    <li>Location: {{msg.payload.location}}</li>  \n    <li>Time: {{msg.time}}</li>\n    <li>Weather: {{msg.payload.weather}} </li>\n    <li>Description: {{msg.payload.description}} </li>\n    <li>Detail: {{msg.payload.detail}} </li>\n    <li>Temp: {{msg.payload.tempc}}</li>\n    <li>Humidity: {{msg.payload.humidity}} </li>\n    <li>Windspeed: {{msg.payload.windspeed}} </li>\n    <li>Winddirection: {{msg.payload.winddirection}} </li>\n    <li>Clouds: {{msg.payload.clouds }} </li>\n\n  </ul>\n</div>  \n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":938,"y":33,"wires":[[]]},{"id":"b1085b69.ac3568","type":"http in","z":"cfcf0bda.11d328","name":"","url":"/radar","method":"get","upload":false,"swaggerDoc":"","x":634,"y":455,"wires":[["c621e220.7c828"]]},{"id":"c621e220.7c828","type":"template","z":"cfcf0bda.11d328","name":"page","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n    <head></head>\n    <body>\n        <script src='https://darksky.net/map-embed/@radar,2019-2-7,16,45.421,-75.690,7.js?embed=true&timeControl=false&fieldControl=false&defaultField=radar'></script>\n    </body>\n</html>","x":764,"y":455,"wires":[["83538c29.a4c3c"]]},{"id":"83538c29.a4c3c","type":"http response","z":"cfcf0bda.11d328","name":"","statusCode":"","headers":{},"x":904,"y":455,"wires":[]},{"id":"670c4d4c.f2f294","type":"ui_template","z":"cfcf0bda.11d328","group":"f01b1ec9.c35bf","name":"Environment Canada","order":0,"width":0,"height":0,"format":"<div>\n    <!-- Begin WeatherLink Fragment -->\n<iframe title=\"Environment Canada Weather\" \n    width=\"287px\" height=\"191px\" \n    src=\"//weather.gc.ca/wxlink/wxlink.html?cityCode=on-52&amp;\n    lang=e\" allowtransparency=\"true\" frameborder=\"0\">\n</iframe>\n<!-- End WeatherLink Fragment -->\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":236,"y":392,"wires":[[]]},{"id":"eeab6771.4aef38","type":"ui_template","z":"cfcf0bda.11d328","group":"f01b1ec9.c35bf","name":"Environment Canada - Westport","order":0,"width":0,"height":0,"format":"<div>\n    <!-- Begin WeatherLink Fragment -->\n<iframe title=\"Environment Canada Weather\" \n    width=\"287px\" height=\"191px\" \n    src=\"//weather.gc.ca/wxlink/wxlink.html?cityCode=on-66&amp;\n    lang=e\" allowtransparency=\"true\" frameborder=\"0\">\n</iframe>\n<!-- End WeatherLink Fragment -->\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":249,"y":443,"wires":[[]]},{"id":"d6f99440.0b1de8","type":"zwave-in","z":"ad7646e2.e0b638","name":"","controller":"35c42763.98b268","x":55,"y":439,"wires":[["45698ede.3d32","3e4ff5c6.4edd5a","38073c45.95bf44","bf9186c7.38b868"]]},{"id":"8689aa2a.ad6878","type":"zwave-out","z":"ad7646e2.e0b638","name":"Toggle Switch","controller":"35c42763.98b268","x":664,"y":700,"wires":[["b0aa99b4.b23b58"]]},{"id":"cb681029.a7498","type":"zwave-out","z":"ad7646e2.e0b638","d":true,"name":"Poll","controller":"35c42763.98b268","x":370,"y":123,"wires":[["f8c55397.7f155"]]},{"id":"43c4db3a.541ff4","type":"zwave-out","z":"ad7646e2.e0b638","name":"","controller":"35c42763.98b268","x":440,"y":42,"wires":[[]]},{"id":"f27b5101.fb806","type":"ui_switch","z":"ad7646e2.e0b638","name":"","label":"Switch","tooltip":"switch control","group":"386605b8.09767a","order":0,"width":"2","height":"2","passthru":false,"decouple":"false","topic":"zwave/switch/1","style":"","onvalue":"true","onvalueType":"bool","onicon":"fa-lightbulb-o fa-5x","oncolor":"yellow","offvalue":"false","offvalueType":"bool","officon":"fa-lightbulb-o fa-4x","offcolor":"grey","x":423,"y":193,"wires":[["9d3d5f00.108b5","e77e0120.c4eb5"]]},{"id":"e77e0120.c4eb5","type":"function","z":"ad7646e2.e0b638","name":"","func":"if (msg.payload === true){\n    msg.topic = \"switchOn\"\n}\nif (msg.payload === false){\n    msg.topic = \"switchOff\"\n}\n\nmsg.payload = {\"nodeid\":4}\nreturn msg;","outputs":1,"noerr":0,"x":599,"y":463,"wires":[["8689aa2a.ad6878","a78506f6.0a3e58"]]},{"id":"a78506f6.0a3e58","type":"debug","z":"ad7646e2.e0b638","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":771,"y":430,"wires":[]},{"id":"9d3d5f00.108b5","type":"debug","z":"ad7646e2.e0b638","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":760,"y":296,"wires":[]},{"id":"594ed9e.88b3128","type":"debug","z":"ad7646e2.e0b638","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":343,"y":812,"wires":[]},{"id":"f8c55397.7f155","type":"debug","z":"ad7646e2.e0b638","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":165,"y":192,"wires":[]},{"id":"8da8e0ef.f7773","type":"debug","z":"ad7646e2.e0b638","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":254,"y":331,"wires":[]},{"id":"d196c66a.79cd08","type":"json","z":"cfcf0bda.11d328","name":"","property":"payload","action":"","pretty":false,"x":439,"y":184,"wires":[["3bf5066c.c93b7a"]]},{"id":"328ad311.34801c","type":"ui_switch","z":"ad7646e2.e0b638","name":"","label":"Back Lights","tooltip":"switch control","group":"386605b8.09767a","order":0,"width":"2","height":"2","passthru":false,"decouple":"false","topic":"zwave/switch/2","style":"","onvalue":"true","onvalueType":"bool","onicon":"fa-lightbulb-o fa-5x","oncolor":"yellow","offvalue":"false","offvalueType":"bool","officon":"fa-lightbulb-o fa-4x","offcolor":"grey","x":305,"y":685,"wires":[["e77e0120.c4eb5"]]},{"id":"bf9186c7.38b868","type":"function","z":"ad7646e2.e0b638","name":"","func":"var msg2 = {\"payload\": 5};\nif (msg.payload.nodeid == 4) {\n    if (msg.payload.currState === true){\n        msg2.payload = 1;\n        msg.payload = true;\n    } else {\n        msg2.payload = 0;\n        msg.payload = false;\n    }\n}\n\nreturn [msg, msg2];","outputs":2,"noerr":0,"x":85,"y":682,"wires":[["328ad311.34801c"],[]],"inputLabels":["zwave"],"outputLabels":["bool","number"]},{"id":"989ae91b.faa368","type":"ui_switch","z":"f846eb7.5c00618","name":"","label":"Back Lights","tooltip":"switch control","group":"eea15960.b753f8","order":1,"width":"2","height":"2","passthru":false,"decouple":"true","topic":"zwave/switch/1","style":"","onvalue":"true","onvalueType":"bool","onicon":"fa-lightbulb-o fa-5x","oncolor":"yellow","offvalue":"false","offvalueType":"bool","officon":"fa-lightbulb-o fa-4x","offcolor":"grey","x":305,"y":332,"wires":[["842b12b2.7c4ef","a2c59741.961058","ff8185d.1514378"]]},{"id":"6bc5c843.66c3a8","type":"function","z":"f846eb7.5c00618","name":"","func":"var msg2 = {\"payload\": 5};\nif (msg.payload.nodeid == 5) {\n    if (msg.payload.currState === true){\n        msg2.payload = 1;\n        msg.payload = true;\n    } else {\n        msg2.payload = 0;\n        msg.payload = false;\n    }\n}\n\nreturn [msg, msg2];","outputs":2,"noerr":0,"x":304,"y":203,"wires":[["989ae91b.faa368","b732f53e.7d5088"],["b56b0982.905fe8"]],"inputLabels":["zwave"],"outputLabels":["bool","number"]},{"id":"4a6d0173.1a463","type":"zwave-in","z":"f846eb7.5c00618","name":"","controller":"e532d965.990798","x":138,"y":95,"wires":[["6bc5c843.66c3a8","922432a2.73007","6acd9de.7b07164","e7758c70.5b035"]]},{"id":"842b12b2.7c4ef","type":"function","z":"f846eb7.5c00618","name":"","func":"if (msg.payload === true){\n    msg.topic = \"switchOn\"\n}\nif (msg.payload === false){\n    msg.topic = \"switchOff\"\n}\n\nmsg.payload = {\"nodeid\":5}\nreturn msg;","outputs":1,"noerr":0,"x":554,"y":225,"wires":[["aa35f5ab.ce24e8","786410c2.230c9"]]},{"id":"aa35f5ab.ce24e8","type":"zwave-out","z":"f846eb7.5c00618","name":"Toggle Switch","controller":"e532d965.990798","x":619,"y":462,"wires":[["cdf6c6df.2bed88"]]},{"id":"922432a2.73007","type":"debug","z":"f846eb7.5c00618","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":671,"y":47,"wires":[]},{"id":"8cd5a770.123bf8","type":"debug","z":"ad7646e2.e0b638","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":230,"y":90,"wires":[]},{"id":"66c56c5a.e74de4","type":"inject","z":"ad7646e2.e0b638","name":"","topic":"disablePoll","payload":"{\"args\":[5,37,1,0]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":151.5,"y":73,"wires":[["43c4db3a.541ff4"]]},{"id":"b732f53e.7d5088","type":"debug","z":"f846eb7.5c00618","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":496.5,"y":107,"wires":[]},{"id":"b56b0982.905fe8","type":"debug","z":"f846eb7.5c00618","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":492.5,"y":171,"wires":[]},{"id":"a2c59741.961058","type":"debug","z":"f846eb7.5c00618","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":407.5,"y":425,"wires":[]},{"id":"786410c2.230c9","type":"debug","z":"f846eb7.5c00618","name":"z wave message","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":764.5,"y":206,"wires":[]},{"id":"cdf6c6df.2bed88","type":"debug","z":"f846eb7.5c00618","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":784.5,"y":399,"wires":[]},{"id":"c3ee6791.f73548","type":"debug","z":"cfcf0bda.11d328","name":"Dark Sky Weather","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":948.5,"y":229,"wires":[]},{"id":"95b37802.2e0108","type":"inject","z":"a02f08d3.ba2c78","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":331.5,"y":163,"wires":[["83362ebe.f275a"]]},{"id":"83362ebe.f275a","type":"function","z":"a02f08d3.ba2c78","name":"set zwave message","func":"msg.topic = \"getNodeStatistics\";\nmsg.payload = {\"args\": [5]};\nreturn msg;","outputs":1,"noerr":0,"x":547.5,"y":58,"wires":[["53bdd792.808598","f6c12f07.0f0ab"]]},{"id":"53bdd792.808598","type":"zwave-out","z":"a02f08d3.ba2c78","name":"send message","controller":"e532d965.990798","x":634.75,"y":187.25,"wires":[["f6c12f07.0f0ab"]]},{"id":"f6c12f07.0f0ab","type":"debug","z":"a02f08d3.ba2c78","name":"sent message","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":965.5,"y":197,"wires":[]},{"id":"4bc17102.fc97","type":"zwave-in","z":"a02f08d3.ba2c78","name":"receive","controller":"e532d965.990798","x":410.5,"y":570,"wires":[["530916f3.977ae8"]]},{"id":"530916f3.977ae8","type":"debug","z":"a02f08d3.ba2c78","name":"zwave data","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":706.5,"y":637,"wires":[]},{"id":"a1dc4deb.fe65e","type":"inject","z":"a02f08d3.ba2c78","name":"","topic":"requestAllConfigParams","payload":"{\"args\":[5,37,1,0]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":246.5,"y":251,"wires":[["53bdd792.808598","f6c12f07.0f0ab"]]},{"id":"1ff834bd.42452b","type":"inject","z":"a02f08d3.ba2c78","name":"requestAllConfigParams","topic":"requestAllConfigParams","payload":"{\"args\":[4]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":320.5,"y":337,"wires":[["53bdd792.808598","f6c12f07.0f0ab"]]},{"id":"f4ecdaa8.7feb78","type":"inject","z":"a02f08d3.ba2c78","name":"setNodeName","topic":"setNodeName","payload":"{\"args\":[4,\"Outlet Switch\"]}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":266.5,"y":407,"wires":[["f6c12f07.0f0ab","53bdd792.808598"]]},{"id":"c3812a97.ab10e8","type":"inject","z":"a02f08d3.ba2c78","name":"","topic":"softReset","payload":"{\"prependHomeId\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":313.5,"y":467,"wires":[["53bdd792.808598","f6c12f07.0f0ab"]]},{"id":"3b92bb33.b892a4","type":"inject","z":"a02f08d3.ba2c78","name":"","topic":"healNetwork","payload":"{\"prependHomeId\":true}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":316.5,"y":86,"wires":[["53bdd792.808598","f6c12f07.0f0ab"]]},{"id":"93109e7b.c0fa5","type":"bigtimer","z":"a02f08d3.ba2c78","outtopic":"5","outpayload1":"","outpayload2":"","name":"Big Timer","comment":"","lat":"45.17084","lon":"-75.93025","starttime":"5004","endtime":"5004","starttime2":"5003","endtime2":"5003","startoff":0,"endoff":"120","startoff2":"-60","endoff2":0,"offs":0,"outtext1":"On","outtext2":"Off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":873,"y":463.625,"wires":[["23291210.2250fe"],["542b867b.243dc8"],["16ae8f38.b85081","89eba506.0e0248"]]},{"id":"23291210.2250fe","type":"debug","z":"a02f08d3.ba2c78","name":"Timer","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1168.25,"y":354.96875,"wires":[]},{"id":"542b867b.243dc8","type":"debug","z":"a02f08d3.ba2c78","name":"Timer2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1138.5,"y":428,"wires":[]},{"id":"16ae8f38.b85081","type":"debug","z":"a02f08d3.ba2c78","name":"Timer3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1119.5,"y":504,"wires":[]},{"id":"89eba506.0e0248","type":"function","z":"a02f08d3.ba2c78","name":"Control Patio Light","func":"if (msg.payload == \"On\"){\n    msg.topic=\"switchOn\"\n} else {\n    msg.topic=\"switchOff\"\n}\nmsg.payload = {\"nodeid\":5}    \nreturn msg;","outputs":1,"noerr":0,"x":953.5,"y":563,"wires":[["45332f1e.85521","b4b97c76.4dfb6","2b45842f.7077ac"]]},{"id":"45332f1e.85521","type":"debug","z":"a02f08d3.ba2c78","name":"potential zwave msg","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1200.5,"y":575,"wires":[]},{"id":"cc448265.78f5e","type":"zwave-in","z":"1d519822.8be128","name":"z-wave Door Lock Status","controller":"e532d965.990798","x":245,"y":208,"wires":[["87f99b3.cd56f68"]]},{"id":"87f99b3.cd56f68","type":"switch","z":"1d519822.8be128","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"zwave: driver ready","vt":"str"},{"t":"eq","v":"zwave: node added","vt":"str"},{"t":"eq","v":"zwave: value added","vt":"str"},{"t":"eq","v":"zwave: notification","vt":"str"},{"t":"eq","v":"zwave: value changed","vt":"str"},{"t":"eq","v":"zwave: node ready","vt":"str"},{"t":"eq","v":"zwave: scan complete","vt":"str"}],"checkall":"true","repair":false,"outputs":7,"x":425,"y":308,"wires":[["81f10e8c.12fd7"],["42941996.f30078"],["77dee769.ff44b8"],["578f32c6.341dcc"],["510480e3.59866"],["9c672f36.3cd55"],["3739e7f5.7d2378"]]},{"id":"81f10e8c.12fd7","type":"function","z":"1d519822.8be128","name":"init nodes","func":"flow.set(\"nodes\", []);\nflow.set(\"scanComplete\", false);\n\n","outputs":"0","noerr":0,"x":668,"y":205,"wires":[]},{"id":"42941996.f30078","type":"function","z":"1d519822.8be128","name":"add node","func":"var nodes = flow.get(\"nodes\");\nmsg.payload.values = [];\nmsg.payload.ready = false;\nnodes.push(msg.payload);\n\n","outputs":"0","noerr":0,"x":667,"y":239,"wires":[]},{"id":"77dee769.ff44b8","type":"function","z":"1d519822.8be128","name":"add value to node","func":"var nodes = flow.get(\"nodes\");\nvar n = nodes.find(n => n.nodeid == msg.payload.nodeid);\nvar value = msg.payload.value;\nn.values.push(value);\n\n//optionally send enablepool \nif(value.label == \"Temperature\"){\n    node.send({topic: \"enablePool\", payload: {\"args\": [value.nodeid, value.cmdclass]}});\n}\n\n\n","outputs":"0","noerr":0,"x":697,"y":275,"wires":[]},{"id":"578f32c6.341dcc","type":"function","z":"1d519822.8be128","name":"notification","func":"var nodes = flow.get(\"nodes\");\nvar nodeid = msg.payload.nodeid;\nvar n = nodes.find(n => n.nodeid == nodeid);\n\nswitch (msg.payload.notification) {\n    case 0:\n      console.log('node%d: message complete', nodeid);\n      break;\n    case 1:\n      console.log('node%d: timeout', nodeid);\n      break;\n    case 2:\n      console.log('node%d: nop', nodeid);\n      break;\n    case 3:\n      console.log('node%d: node awake', nodeid);\n      break;\n    case 4:\n      console.log('node%d: node sleep', nodeid);\n      break;\n    case 5:\n      console.log('node%d: node dead', nodeid);\n      n.ready = false;\n      node.send({topic: \"node_status\", nodeid: nodeid, payload: false});\n      break;\n    case 6:\n      console.log('node%d: node alive', nodeid);\n      n.ready = true;\n      node.send({topic: \"node_status\", nodeid: nodeid, payload: true});\n      break;\n }\nmsg.topic = \"zwave\";\nreturn msg;","outputs":1,"noerr":0,"x":675,"y":314,"wires":[["108d37c1.805778"]]},{"id":"510480e3.59866","type":"function","z":"1d519822.8be128","name":"value changed","func":"var nodes = flow.get(\"nodes\");\nvar node = nodes.find(n => n.nodeid == msg.payload.nodeid);\nvar value = node.values.find(v => v.value_id == msg.payload.value.value_id);\nvalue.value = msg.payload.value.value;\nmsg.topic = \"zwave\";\nmsg.payload = \"Value Changed\" + msg.payload.nodeid;\nreturn msg;","outputs":"1","noerr":0,"x":683,"y":355,"wires":[["108d37c1.805778"]]},{"id":"9c672f36.3cd55","type":"function","z":"1d519822.8be128","name":"node ready","func":"var nodes = flow.get(\"nodes\");\nvar n = nodes.find(n => n.nodeid == msg.payload.nodeid);\nn.ready = true;\nn.type = msg.payload.nodeinfo.type;\n\nmsg.topic = \"zwave\";\nmsg.payload = \"node ready\" + msg.payload.nodeid;\nreturn msg;\n\n/* NODEINFO\n{\"manufacturer\":\"Qubino\",\"manufacturerid\":\"0x0159\",\"product\":\"ZMNHKDx Flush Heat and Cool thermostat\",\"producttype\":\"0x0005\",\"productid\":\"0x0052\",\"type\":\"Thermostat HVAC\",\"name\":\"\",\"loc\":\"\"}\n*/","outputs":1,"noerr":0,"x":675,"y":394,"wires":[["108d37c1.805778"]]},{"id":"3739e7f5.7d2378","type":"function","z":"1d519822.8be128","name":"scan complete","func":"var nodes = flow.get(\"nodes\");\nflow.set(\"scanComplete\", true);\nmsg.topic = \"zwave\";\nmsg.payload = \"Scan Complete\";\nreturn msg;","outputs":"1","noerr":0,"x":684,"y":432,"wires":[["108d37c1.805778"]]},{"id":"b4b97c76.4dfb6","type":"mqtt out","z":"a02f08d3.ba2c78","name":"","topic":"/junk","qos":"","retain":"","broker":"27947665.ffe50a","x":1199.5,"y":629,"wires":[]},{"id":"6031eca0.05d784","type":"mosca in","z":"a02f08d3.ba2c78","mqtt_port":1883,"mqtt_ws_port":8080,"name":"","username":"","password":"","dburl":"","x":1545.5,"y":503,"wires":[[]]},{"id":"2b45842f.7077ac","type":"ui_text","z":"a02f08d3.ba2c78","group":"3c708b73.143c34","order":2,"width":0,"height":0,"name":"","label":"light","format":"{{msg.payload}}","layout":"col-center","x":1178.5,"y":709,"wires":[]},{"id":"7fc2b73c.ac5e08","type":"inject","z":"a02f08d3.ba2c78","name":"","topic":"ON","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":696.5,"y":388,"wires":[["93109e7b.c0fa5"]]},{"id":"e16c3902.8572d8","type":"inject","z":"a02f08d3.ba2c78","name":"","topic":"OFF","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650.5,"y":475,"wires":[["93109e7b.c0fa5"]]},{"id":"732e6c4c.159f94","type":"ui_form","z":"1d519822.8be128","name":"Zwave Messag","label":"","group":"3c708b73.143c34","order":3,"width":0,"height":0,"options":[{"label":"Command","value":"Command","type":"text","required":true,"rows":null},{"label":"Args","value":"Args","type":"text","required":false,"rows":null}],"formValue":{"Command":"","Args":""},"payload":"","submit":"submit","cancel":"cancel","topic":"Zwave Message","x":656.5,"y":823,"wires":[["f308565.1d569a8","1d51d32b.6f39fd"]]},{"id":"1d51d32b.6f39fd","type":"debug","z":"1d519822.8be128","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1039.5,"y":818,"wires":[]},{"id":"f308565.1d569a8","type":"function","z":"1d519822.8be128","name":"","func":"msg.topic = msg.payload.Command\n\nmsg.payload = msg.payload.Args \n\nreturn msg;","outputs":1,"noerr":0,"x":773.5,"y":719,"wires":[["1d51d32b.6f39fd","83a0fce2.4d9ab"]]},{"id":"83a0fce2.4d9ab","type":"zwave-out","z":"1d519822.8be128","name":"send","controller":"e532d965.990798","x":964.5,"y":690,"wires":[["1d51d32b.6f39fd"]]},{"id":"ff8185d.1514378","type":"mqtt out","z":"f846eb7.5c00618","name":"","topic":"","qos":"","retain":"","broker":"27947665.ffe50a","x":477.5,"y":350,"wires":[]},{"id":"48af7432.aca22c","type":"mqtt in","z":"f846eb7.5c00618","name":"","topic":"#","qos":"2","datatype":"auto","broker":"27947665.ffe50a","x":402.5,"y":591,"wires":[["d094e94d.83c688","56c56ef6.e153f"]]},{"id":"d094e94d.83c688","type":"ui_text","z":"f846eb7.5c00618","group":"3c708b73.143c34","order":1,"width":"6","height":"11","name":"","label":"MQTT Data","format":"{{msg.payload}}","layout":"col-center","x":630.5,"y":586,"wires":[]},{"id":"56c56ef6.e153f","type":"debug","z":"f846eb7.5c00618","name":"MQTT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":573.5,"y":639,"wires":[]},{"id":"7774dce8.a90ea4","type":"mqtt out","z":"cfcf0bda.11d328","name":"","topic":"","qos":"","retain":"","broker":"27947665.ffe50a","x":878.5,"y":155,"wires":[]},{"id":"6acd9de.7b07164","type":"mqtt out","z":"f846eb7.5c00618","name":"","topic":"","qos":"","retain":"","broker":"27947665.ffe50a","x":437.5,"y":26,"wires":[]},{"id":"c831ca54.292b08","type":"change","z":"cfcf0bda.11d328","name":"set topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"weather","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":745.5,"y":97,"wires":[["97f6d3cc.a8ed","7774dce8.a90ea4"]]},{"id":"118f793.a031287","type":"ui_button","z":"1d519822.8be128","name":"","group":"3c708b73.143c34","order":3,"width":0,"height":0,"passthru":false,"label":"BackLight On","tooltip":"turn Partio Light On","color":"","bgcolor":"","icon":"","payload":"{\"nodeid\": 5}","payloadType":"json","topic":"switchOn","x":666.5,"y":602,"wires":[["83a0fce2.4d9ab","1d51d32b.6f39fd"]]},{"id":"8e229a32.2b89e8","type":"file","z":"f846eb7.5c00618","name":"zwave messages","filename":"/tmp/zwave/messages","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":140.5,"y":247,"wires":[[]]},{"id":"29bdfa5e.0f5c96","type":"change","z":"cfcf0bda.11d328","name":"set topic","rules":[{"t":"set","p":"topic","pt":"msg","to":"darksky weather","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":737,"y":241,"wires":[["7774dce8.a90ea4","c3ee6791.f73548"]]},{"id":"3bf5066c.c93b7a","type":"debug","z":"cfcf0bda.11d328","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":590.5,"y":183,"wires":[]},{"id":"108d37c1.805778","type":"mqtt out","z":"1d519822.8be128","name":"","topic":"","qos":"","retain":"","broker":"27947665.ffe50a","x":998.5,"y":330,"wires":[]},{"id":"c0217953.404318","type":"debug","z":"fc4d1b9b.590778","name":"","active":true,"console":"false","complete":"true","x":816,"y":228.0000228881836,"wires":[]},{"id":"470d76b2.e524e8","type":"inject","z":"fc4d1b9b.590778","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":166,"y":188.0000228881836,"wires":[["f2cde446.f41c18"]]},{"id":"bb875079.9ab0e","type":"exec","z":"fc4d1b9b.590778","command":"avconv -i rtsp://admin:1234@192.168.86.82:554/Streaming/Channels/301 -r 10 -t 30 -y -vcodec copy -an ","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Capture video","x":586,"y":148.0000228881836,"wires":[["89a200f8.ce219","af713fdf.a9bf9"],["93bfab6b.454e68"],["c0217953.404318"]]},{"id":"89a200f8.ce219","type":"ui_template","z":"fc4d1b9b.590778","group":"9c0b4f36.fcc99","name":"Video link","order":2,"width":0,"height":0,"format":"<div height=\"70\" style=\"height: 70px;\">\n<a href=\"/video.mp4\" target=\"_blank\">Open video</a>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":826,"y":108.0000228881836,"wires":[[]]},{"id":"af713fdf.a9bf9","type":"debug","z":"fc4d1b9b.590778","name":"","active":true,"console":"false","complete":"true","x":816,"y":148.0000228881836,"wires":[]},{"id":"93bfab6b.454e68","type":"file","z":"fc4d1b9b.590778","name":"","filename":"/home/pi/avconv.out","appendNewline":true,"createDir":false,"overwriteFile":"true","x":866,"y":188.0000228881836,"wires":[[]]},{"id":"841afd24.dee51","type":"ui_button","z":"fc4d1b9b.590778","name":"Capture","group":"9c0b4f36.fcc99","order":1,"width":0,"height":0,"passthru":false,"label":"Capture video","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":150.59999084472656,"y":142.13336086273193,"wires":[["f2cde446.f41c18"]]},{"id":"55a404a8.fea42c","type":"comment","z":"fc4d1b9b.590778","name":"Video capture","info":"This section of the flow captures a fixed length \nvideo of the RTSP feed.\nIt works very similar to the frame capture above,\nthe only main difference is the parameters in the\ncommmand line.","x":147.99998474121094,"y":88,"wires":[]},{"id":"f2cde446.f41c18","type":"change","z":"fc4d1b9b.590778","name":"Set filename","rules":[{"t":"set","p":"payload","pt":"msg","to":"/home/pi/.node-red/public/video.mp4","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":336,"y":148.0000228881836,"wires":[["bb875079.9ab0e"]]},{"id":"7544741.7493f8c","type":"function","z":"fc4d1b9b.590778","name":"Video capture","func":"var now = new Date();\n// Create formatted time\nvar yyyy = now.getFullYear();\nvar mm = now.getMonth() < 9 ? \"0\" + (now.getMonth() + 1) : (now.getMonth() + 1); // getMonth() is zero-based\nvar dd  = now.getDate() < 10 ? \"0\" + now.getDate() : now.getDate();\nvar hh = now.getHours() < 10 ? \"0\" + now.getHours() : now.getHours();\nvar mmm  = now.getMinutes() < 10 ? \"0\" + now.getMinutes() : now.getMinutes();\nvar ss  = now.getSeconds() < 10 ? \"0\" + now.getSeconds() : now.getSeconds();\n\n// Last update: \"+dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss});\n\n// file path with / at the end\nvar path = \"/home/pi/.node-red/public/\";                     // This is the path\nvar filename = \"video_\"+yyyy+mm+dd+\"-\"+hh+mm+ss+\".mp4\";     // file name\nmsg.payload = path + filename;                              // pass the full path to payload for the exec node to add to the end of the command\nmsg.file = filename;                                        // To be used later to store the information in the DB\nmsg.path = path;                                            // Same as above\nmsg.wwwpath = \"/\";                                          // Same as above\nmsg.topic = \"store\";                                        // Flag to store this image in the DB\nmsg.type = \"videotest\";                                     // Image type e.g. Front camera, etc.\nmsg.epoch = now.getTime();                                  // Current timestamp\nmsg.formatteddate = dd + \".\" + mm + \".\" + yyyy + \" \" + hh + \":\" + mmm + \":\" + ss;   // Formatted timestamp to be used later\n\nreturn msg;","outputs":1,"noerr":0,"x":366,"y":268.0000228881836,"wires":[["bb875079.9ab0e"]]},{"id":"83fb22ed.41fb2","type":"inject","z":"fc4d1b9b.590778","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":166,"y":268.0000228881836,"wires":[["7544741.7493f8c"]]},{"id":"e7758c70.5b035","type":"flogger","z":"f846eb7.5c00618","name":"Zwave Log","logfile":"zlog.log","inputchoice":"fullmsg","inputobject":"payload","inputobjectType":"msg","inputmoustache":"Recieved payload {{payload}} and topic {{topic}}","loglevel":"INFO","logconfig":"9a2a6ad4.863528","sendpane":"","x":108.5,"y":172,"wires":[["8e229a32.2b89e8"]]},{"id":"b0aa99b4.b23b58","type":"mqtt out","z":"ad7646e2.e0b638","name":"","topic":"","qos":"","retain":"","broker":"27947665.ffe50a","x":857.5,"y":696,"wires":[]}]
